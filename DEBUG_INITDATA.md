# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞ —Å initData

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –¥–ª—è GitHub Pages
**–§–∞–π–ª**: `.env`
```bash
WEBAPP_URL=https://delmmv.github.io/telegram-bot-workshop/
WEBAPP_ORIGINS=https://delmmv.github.io,https://delmmv.github.io/telegram-bot-workshop/
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API URL –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–§–∞–π–ª**: `webapp/.env.local`
```bash
NEXT_PUBLIC_API_BASE_URL=https://service.monopiter.ru
```

### 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—ç–∫–µ–Ω–¥–µ
**–§–∞–π–ª**: `rating.js` (—Å—Ç—Ä–æ–∫–∏ 2504-2526)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ CORS
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ origins
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
**–§–∞–π–ª**: `webapp/app/page.tsx`
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ console.error –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ü—Ä–æ–≤–µ—Ä–∫–∞ health API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

### 5. –£–ª—É—á—à–µ–Ω–Ω—ã–π API –∫–ª–∏–µ–Ω—Ç
**–§–∞–π–ª**: `webapp/lib/api.ts`
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ network errors

### 6. –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**–§–∞–π–ª**: `check-config.js`
- –ó–∞–ø—É—Å–∫: `node check-config.js`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

## üöÄ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥
```bash
cd /Users/mac/WebstormProjects/telegram-bot-workshop
node rating.js
```

–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
```
Loaded config: { API_PORT: 5800, WEBAPP_ORIGINS: [...], ... }
Server running on port 5800
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **—á–µ—Ä–µ–∑ Telegram** (–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
3. –ò—â–∏—Ç–µ –ª–æ–≥–∏:

**‚úÖ –£—Å–ø–µ—Ö:**
```
[DEBUG] Telegram WebApp initialized
[DEBUG] initData length: 450
[API] üöÄ Request: { url: "https://service.monopiter.ru/api/health", ... }
[API] ‚úÖ Success: { data: { ok: true } }
```

**‚ùå –ü—Ä–æ–±–ª–µ–º–∞:**
```
[ERROR] initData is empty!
[API] ‚ùå Network error - Cannot reach API server
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –æ—Ç –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
[API] Incoming request: GET /api/health
[API] Origin: https://delmmv.github.io
[API] Allowed origins: [ 'https://delmmv.github.io', 'https://delmmv.github.io/telegram-bot-workshop/' ]
[API] ‚úÖ Origin allowed: https://delmmv.github.io
```

## üîç –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. `initData` –ø—É—Å—Ç–æ–π
**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω–µ Telegram
**–†–µ—à–µ–Ω–∏–µ**: –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram ‚Üí Bot ‚Üí Mini App

### 2. `CORS error`
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ WEBAPP_ORIGINS
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env`, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

### 3. `Network error`
**–ü—Ä–∏—á–∏–Ω–∞**: API —Å–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `https://service.monopiter.ru` —Ä–∞–±–æ—Ç–∞–µ—Ç

### 4. `401 Unauthorized`
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π initData
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Mini App –≤ Telegram

## üìã –§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

- ‚úÖ `.env` - CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ `webapp/.env.local` - API URL  
- ‚úÖ `rating.js` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CORS
- ‚úÖ `webapp/app/page.tsx` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ `webapp/lib/api.ts` - –æ—Ç–ª–∞–¥–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

## üéØ –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å:

1. ‚úÖ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. ‚úÖ `initData` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-Telegram-Init-Data`
3. ‚úÖ –ë—ç–∫–µ–Ω–¥ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ HMAC-SHA256
4. ‚úÖ –û—à–∏–±–∫–∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è